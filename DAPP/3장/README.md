# 블록체인 기본

**블록체인 - 중재자 없이 자율적으로 동작하는 분산 시스템 기술**
화폐 거래 내역을 '블록'으로 저장한 후 해당 블록의 해시값을 다른 블록에 저장하여 체인 형태로 이루어지도록 만듬.

---

### DAPP
> DApp(Decentralized Application) 탈중앙화 애플리케이션
> 블록체인상에 돌아가는 스마트 계약 기반 애플리케이션

**주소(address)**
공개키 암호로 암호화폐를 보내고 받는 문자열
**지갑(wallet)**
거래에 필요한 개인키를 저장한 공간
**거래(transaction)**
코인과 토큰 소유권을 포함하는 데이터가 기록되고 작성자의 전자 서명을 적용해 코인 및 토큰 발행을 증명한다.
**컨펌(confirmation)**
거래를 블록에 저장시켜 기존의 거래 내역과 새로운 거래 내역을 검증하는 것.
컨펌 횟수가 많을수록 확정한 거래 내역의 신뢰도가 보장된다.

코인, 토큰은 메인넷에서 발행한 암호화폐를 코인이라 하며, 이 블록체인 시스템을 통해 발행한 것을 토큰이라 한다.

### 해시함수
> 입력값에 대해 해시를 사용해 다른 값을 출력하는 함수로서, SHA-256, RIPEMD-160등이 잇다.

(특징) 일방향 함수, 비가역성 -> 출력값은 입력값의 길이와 상관없이 고정된 길이를 갖고, 입력값이 다르면 출력값도 다르다.

* 해시 트리(hash tree)
이진 트리 형태로 나누고 같은 높이에 잎 노드가 하나면, 같은 노드를 복사하여 묶는다.
그리고 두 쌍에 대한 해시값을 계산하고 이 해시값이 하나만 남을 때까지 반복 계산하고 마지막에 남은 해시값을 해시 루트(hash root)라고 한다.

블록체인은 모든 데이터를 연결한 '블록'으로 노드 전체와 데이터를 공유하고 '해시 트리'를 해시 체인으로 구성해 블록을 만들며, 다음 조건을 만족해야 한다.
1. P2P 네트워크의 모든 노드가 항상 최신 타임스탬프를 확인할 수 있어야 한다.
2. 어떤 노드에서 과거 데이터를 조작했음을 확인하거나 이를 막을 수 있어야 한다.

### 어드레스
비트코인 어드레스는 일반적으로 공개키의 해시값으로 만든다.
> SHA-256으로 공개키의 해시값 -> 이 값에 대해 RIPEMD-160으로 해시값 만듦 -> Base58Check로 인코딩

### 디지털 서명
> 공개키 암호를 응용하여 전송받은 데이터의 송신자를 검증하거나 전송 과정에서 변조되지 않았는지를 확인하는 기술이다. (공개키 암호는 비밀키와 공개키라는 한 쌍의 키에 기반을 둔다.)

> 송신자의 비밀키로 만든 데이터의 해시값이 수신자가 갖고 있는 공개키로 복호화한 해시값과 일치하는지를 통해 공개키와 짝을 이루는 비밀키를 가진 사람이 데이터를 보냈음을 신뢰한다.

### 비트코인 거래
> P2P 노드는 노드 간에 전파가 이루어지므로 적어도 하나의 노드에는 전파해야 한다.
> 거래를 전달받은 노드는 특정 조건을 만족하는지 검증한 다음 만족하면 거래를 전달한 노드에 성공 메시지를 보내고 다른 노드에 이를 전파한다. (유효 하지 않은 거래를 대량으로 전송하여 서비스 거부 공격 불가.)

**거래는 최종적으로 채굴자에 의해 검증받은 후 블록에 저장된다.**

> 채굴(mining)은 채굴자 계산적인 방법으로 최근의 트랜잭션 이력인 블록을 블록체인에 최신 블록으로 만드는 작업.

### 블록 구조
(블록의 구조 : 필드 / 필드 크기(바이트) / 설명)
- block size : 4 : 다음 필드부터 블록 끝까지의 데이터 크기
- block header : 80 : 블록 헤더 정보
- transaction counter : 1~9 : 블록에 포함된 거래의 수
- transaction : 가변적 : 거래의 목록

(블록 헤더의 구조)
- version : 4 : 소프트웨어 / 프로토콜 버전 정보
- previous block hash : 32 : 부모 블록의 해시값
- merkle root : 32 : 머클 트리 루트의 해시값
- timestamp : 4 : 블록 생성 시간
- difficulty target : 4 : 블록 생성 시 PoW 난이도
- nonce : 4 : Pow에서 사용하는 카운터

### 머글 트리
![머글 트리](https://upload.wikimedia.org/wikipedia/commons/9/95/Hash_Tree.svg)

### 작업 증명 알고리즘
> 암호화 해시 함수의 특정 해시값 이하인 입력값(논스 nonce) 찾기를 작업 증명 알고리즘으로 삼는다.
> SHA-256을 두 번 연산하여 작업 증명 알고리즘으로 사용하는데, 보상으로 새 블록을 생성하여 비트코인을 받는 채굴이라 한다.

* 평균 10분에 1회 새 블록을 생성하도록 타깃을 조정하고, 최근 2016 블록의 타깃을 검토해 블록 생성 시간이 2016*10분보다 빠르면 논스를 찾기 어렵게 블록 간격을 조정하고, 늦으면 논스를 찾기 쉽게 난이도를 조정한다.
* 이 블록 하나의 용량은 1MB 이하로 설정하고 블록 해시값 계산이 끝났을 때 유닉스 타임스탬프를 설정한다.
* 더블 스펜딩을 막기 위해 블록 높이가 같은 블록에 서로 다른 정보가 있으면 작업 증명 알고리즘의 난이도가 높은 블록을 선택해 전달한다. (블록 높이가 다른 블록이면 긴 체인의 정보를 선택해 전달한다.)
* 51% 공격은 PoW에서 특정 개인이나 그룹이 비트코인 네트워크 연산량의 51%를 통제하면 부정한 이중지불이나 고의로 블록체인을 코하는 일이 가능해진다.

### UTXO (Unspent Transaction Output) 사용하지 않은 거래 출력
> 이더리움의 경우 어카운트 기반으로 계좌 잔액을 송금 요청대로 업데이트하거나 롤백한다. (계좌 업데이트 실패 시 돈이 없어짐)
> 비트코인의 경우 트랜잭션 기반으로, 원하는 금액을 자유롭게 송금하고 거스름돈을 받는 자료 구조
-> 비트코인은 새 블록을 생성한 채굴자에게만 보상으로 첫 번째 인덱스에 들어가는 UTXO 발행

### 지갑
> 거래에 사용하는 비밀키를 저장하는 용도로 핫 월렛 / 콜드 월렛 두 가지 타입이 있다.
